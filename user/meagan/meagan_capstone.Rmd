---
title: "Meagan Capstone"
author: "Meagan Brown"
date: "2023-04-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries
```{r}
library(tidyverse)
library(sf)
library(here)
library(janitor)
library(fasterize)
```

```{r}
# set working directory
setwd(here('~', 'meds', 'capstone', 'aquafire'))
```

## Load Boundaries
```{r}
# Load in ecoregions shapefile
eco_regions <- read_sf(here::here('data', 'ca_eco_l3')) %>% 
  janitor::clean_names()  %>% 
  st_transform("EPSG: 3309") %>% 
  rename(region = us_l3name)

# Read in CA county boundaries
ca_counties <- read_sf(here::here('data', 'CA_Counties')) %>% 
  janitor::clean_names() %>% 
  st_transform("EPSG: 3309") # NAD27 / California Albers

# Filter sb county
sb_county <- ca_counties %>% 
  filter(name == "Santa Barbara")
```

## Load GDE Data
```{r}
veg_layer <- st_read(dsn = here('data', 'i02_NaturalCommunitiesCommonlyAssociatedwithGroundwater_v2_0.gdb'),
                     layer = 'i02_NCCAG_Vegetation_2_0') %>% 
  st_transform("EPSG: 3309")

wetland_layer <- st_read(dsn = here('data', 'i02_NaturalCommunitiesCommonlyAssociatedwithGroundwater_v2_0.gdb'),
                     layer = 'i02_NCCAG_Wetlands_2_0')

wetland_layer <- wetland_layer %>% 
  mutate('val' = 1)

gde <- gde %>% 
  mutate('val' = 1)

ca <- st_crop(gde_veg, ca_counties) %>%
  mutate(val = 1)

ca_ext <- extent(ca)
ca_rast <- raster(ca_ext, resolution = 30) # check that this is 30 *meters* 
crs(ca_rast) <- "+init=epsg:3309" # set crs

fasterize(st_collection_extract(gde_layer, "LINESTRING"), ca_rast, field = 'val', background = 0)

fasterize(gde_layer, ca_rast, field = "val", fun="sum")

gde_raster <- fasterize(sf = gde_layer,
                        raster = ca_rast,
                        field = NULL,
                        fun = "count")

# # read in groundwater dependent ecosystem shapefile + clean names
# gde_veg <- read_sf(here('data',
#                         'i02_naturalcommunitiescommonlyassociatedwithgroundwater',
#                         'i02_NCCAG_Vegetation.shp')) %>%
#   clean_names() %>%
#   st_transform("EPSG: 3309") # NAD27 / California Albers
# 
# gde_wetlands <- read_sf(here('data','i02_naturalcommunitiescommonlyassociatedwithgroundwater','i02_NCCAG_Wetlands.shp')) %>%
#   clean_names()  %>%
#   st_transform("EPSG: 3309") # NAD27 / California Albers
# 
# gde <- st_join(gde_veg, gde_wetlands)
# 
# gde_ndvi <- st_read(here('data', 'i02_NaturalCommunitiesCommonlyAssociatedwithGroundwater_v2_0.gdb')) %>% 
#   st_transform("EPSG: 3309") %>% 
#   clean_names() %>% 
#   st_cast(gde_ndvi, "MULTIPOLYGON")
```

## Load Fire Data
```{r}
fire_perimeters_all <- sf::read_sf(here('data', 
                                        'California_Fire_Perimeters_all')) %>% 
  clean_names() %>% 
  st_transform("EPSG: 3309") # NAD27 / California Albers
```

## Burn Severity
```{r}
#load libraries
library(tidyverse)
library(dplyr)
library(here)
library(janitor)
library(tmap)
library(stars)
library(gridExtra)
library(raster)
library(terra)
```

# METHOD 1

```{r}
# Load the terra package
library(terra)

# Set the working directory to the folder containing the .tif files
setwd("~/meds/capstone/aquafire/data/MTBS_BSmosaics")

# Get a list of .tif files in the directory
tif_files <- list.files(pattern = "\\.tif$")

# Use a loop to read the .tif files into a list of Raster* objects
raster_list <- list()
for (i in 1:length(tif_files)) {
  raster_list[[i]] <- rast(tif_files[i])
}

```


