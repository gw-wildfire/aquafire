---
title: "Burn Severity"
author: "Meagan Brown"
date: "2023-05-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
# load libraries
library(tidyverse)
library(dplyr)
library(here)
library(janitor)
library(tmap)
library(stars)
library(gridExtra)
library(raster)
library(terra)
library(tictoc)
library(tmap)
```


```{r}
# set working directory
setwd(here('~', 'meds', 'capstone', 'aquafire'))
```

## Burn Severity
```{r}
#load libraries
library(tidyverse)
library(dplyr)
library(here)
library(janitor)
library(tmap)
library(stars)
library(gridExtra)
library(raster)
library(terra)
```

### Read in Burn Severity All .tif file
```{r}
burn_severity_stack <- rast(here::here('raster_output', 'burn_severity_all.tif'))
```


### Burn Severity All for loop - takes 3 hours to load
```{r}
# Load the necessary library
library(terra)

# Define the directory where the raster files are located
raster_dir <- here::here("data", "MTBS_BSmosaics")

# Define the target CRS
target_crs <- "EPSG:3310"

# Get a list of .tif files in the directory
tif_files <- list.files(raster_dir, pattern = "\\.tif$", full.names = TRUE)

# Initialize the raster stack variable
raster_stack <- NULL

# Loop through the files
for (file_path in tif_files) {
  # Print a message to the console
  message("Processing file: ", file_path)

  # Read the raster file
  raster <- rast(file_path)
  
  # Project the raster to the target CRS
  raster_new_crs <- project(raster, target_crs)
  
  # If this is the first file, initialize the raster stack
  if (is.null(raster_stack)) {
    raster_stack <- raster_new_crs
  } else {
    # Otherwise, resample the raster to match the first, and add it to the stack
    raster_resampled <- resample(raster_new_crs, raster_stack, method = "near")
    raster_stack <- c(raster_stack, raster_resampled)
  }
}

writeRaster(raster_stack, file.path(here::here('raster_output', 'burn_severity_all.tif')))

# Plot the raster stack
plot(raster_stack, main = "Burn Severity 1984-2021")
```




