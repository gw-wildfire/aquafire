---
title: 'Stats: % Area Burned'
author: "Andre Dextre"
date: "2023-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(raster)
library(here)
library(janitor)
library(sf)
library(rgdal)
```

## Load Raster Files
```{r}
fire_raster <- raster(here("raster_output", "CA_fire_perimeters.tif"))

gde_1 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_1.tif"))
gde_4 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_4.tif"))
gde_5 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_5.tif"))
gde_6 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_6.tif"))
gde_7 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_7.tif"))
gde_8 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_8.tif"))
gde_9 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_9.tif"))
gde_13 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_13.tif"))
gde_14 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_14.tif"))
gde_78 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_78.tif"))
gde_80 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_80.tif"))
gde_81 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_81.tif"))
gde_85 <- raster(here("raster_output", "GDE RASTERS by Eco Region", "gde_85.tif"))
```

### Create Empty Vectors

```{r}
# Create empty vectors to store the results
ecoregion_names <- vector()
percent_burned_gde <- vector()
percent_burned_non_gde <- vector()
```

```{r}
# Function to check if two extents overlap
overlaps <- function(e1, e2) {
  (e1[1] < e2[2]) & (e1[2] > e2[1]) & (e1[3] < e2[4]) & (e1[4] > e2[3])
}

```

```{r}
# Plot data
plot(gde_raster, main = "GDEs and Ecoregions")
plot(ecoregions, add = TRUE, border = 'red') # Ecoregions borders in red

plot(fire_raster, main = "Fire Perimeter and Ecoregions")
plot(ecoregions, add = TRUE, border = 'red') # Ecoregions borders in red
```

```{r}
# Function to calculate the percentage of burned area within GDEs and non-GDEs
calc_burned_percent <- function(gde_raster) {
  # Ensure both rasters are in the same extent
  fire_raster <- crop(fire_raster, extent(gde_raster))
  
  # Re-sample the fire raster to match the GDE raster
  fire_raster <- resample(fire_raster, gde_raster, method = "ngb")

  # Create a raster where 1 = GDE & Burned, 0 = otherwise
  burned_in_gde <- gde_raster * fire_raster

  # Calculate percentage of GDE area that is burned
  gde_area_burned_percent <- sum(burned_in_gde[] == 1, na.rm = TRUE) / sum(gde_raster[] == 1, na.rm = TRUE) * 100

  # Create a raster where 1 = Non-GDE & Burned, 0 = otherwise
  burned_in_non_gde <- (1 - gde_raster) * fire_raster
  
  # Calculate percentage of non-GDE area that is burned
  non_gde_area_burned_percent <- sum(burned_in_non_gde[] == 1, na.rm = TRUE) / sum(gde_raster[] == 0, na.rm = TRUE) * 100

  return(c(gde_area_burned_percent, non_gde_area_burned_percent))
}

```

```{r}
# List of GDE rasters
gde_rasters <- list(gde_1, gde_4, gde_5, gde_6, gde_7, gde_8, gde_9, gde_13, gde_14, gde_78, gde_80, gde_81, gde_85)
# Apply function to each GDE raster
burned_percent_results <- sapply(gde_rasters, calc_burned_percent)

# Transpose the result so that each row corresponds to one GDE raster
burned_percent_results <- t(burned_percent_results)

# Add column names
colnames(burned_percent_results) <- c("GDE_Burned_Percent", "Non_GDE_Burned_Percent")

# View results
burned_percent_results
```

```{r}
# Create a vector with GDE names
gde_names <- c('gde_1', 'gde_4', 'gde_5', 'gde_6', 'gde_7', 'gde_8', 'gde_9', 'gde_13', 'gde_14', 'gde_78', 'gde_80', 'gde_81', 'gde_85')

# Assign GDE names to the rows
rownames(burned_percent_results) <- gde_names
```


```{r}
burned_percent_results <- as.data.frame(burned_percent_results)

# Add a new column "GDE_Name" that includes the row names
burned_percent_results$GDE_Name <- rownames(burned_percent_results)
```


```{r}
# Set the width of each bar
bar_width <- 0.35

# Create a vector for the x-axis positions of the bars
x <- 1:length(burned_percent_results$GDE_Burned_Percent)

# Create a vector of unique names for each pair of GDE and non-GDE bars
bar_names <- rep(burned_percent_results$GDE_Name, each = 2)
bar_names <- paste0(bar_names, c("_GDE", "_Non-GDE"))

# Plotting the burned percentages
barplot(height = c(burned_percent_results$GDE_Burned_Percent, burned_percent_results$Non_GDE_Burned_Percent),
        beside = TRUE,
        names.arg = bar_names,
        xlab = "GDE",
        ylab = "Burned Percentage",
        ylim = c(0, 100),
        col = c("blue", "red"),
        main = "Percentage of GDE Area Burned",
        width = bar_width)

# Add a legend
legend("topright",
       legend = c("GDE", "Non-GDE"),
       fill = c("blue", "red"))
```

